{
  "_id": "KjTT5S8MD4M27X9F",
  "name": "Compendium Art Map Format Update",
  "type": "script",
  "author": "qlJaAWzteTnXxED9",
  "command": "/**\nThis macro updates a compendium artwork mapping json file in sfrpg's original format to the new format used by Foundry's native compendium artwork mapping.\nThis macro will update your .json file format, but you will also need to manually update the format of the module you are using to tell Foundry the location of the file. For instructions on how to do this, see the Starfinder 1e system wiki at:\nhttps://github.com/foundryvtt-starfinder/foundryvtt-starfinder/wiki/\n*/\n\nui.notifications.info(\"Please select your original (old style) compendium artwork mapping .json file.\");\nconst filePicker = foundry.applications.apps.FilePicker.implementation;\nnew filePicker({\n  callback: async (path) => {\n\n    // Get file name, folder, and load in data\n    const pathParts = path.split('/');\n    const fileName = pathParts.pop();\n    const folder = `${pathParts.join('/')}/`;\n    const mapData = await fetch(path).then((res) => res.json());\n\n    // For each pack, rejig object keys for each entry as needed\n    for (const [packName, packData] of Object.entries(mapData)) {\n      for (const [entryName, entryData] of Object.entries(packData)) {\n        if (entryData.entryNum) {\n          delete entryData.entryNum;\n        }\n        if (entryData.token) {\n          if (entryData.token.img) {\n            entryData.token.texture = {src: entryData.token.img};\n            delete entryData.token.img;\n          }\n          if (entryData.token?.scale) {\n            delete entryData.token.scale;\n          }\n        } else if (!entryData.token?.texture?.src) {\n          entryData.token = {texture: {src: \"\"}};\n        }\n      }\n\n      // Rename the pack object\n      mapData[`sfrpg.${packName}`] = packData;\n      delete mapData[packName];\n    }\n    const newFile = new File([JSON.stringify(mapData, null, 4)], fileName);\n    await filePicker.upload('data', folder, newFile, {}, {notify:false});\n  }\n  \n}).render();",
  "img": "icons/svg/hanging-sign.svg",
  "scope": "global"
}